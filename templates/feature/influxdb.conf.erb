// managed by puppet

library "perfdata"

object InfluxdbWriter "influxdb" {
  host = "<%= scope['icinga2::feature::influxdb::host'] -%>"
  port = <%= scope['icinga2::feature::influxdb::port'] %>
<% if scope.lookupvar('icinga2::feature::influxdb::database') -%>
  database = "<%= scope['icinga2::feature::influxdb::database'] -%>"
<% end -%>
<% if scope.lookupvar('icinga2::feature::influxdb::username') -%>
  username = "<%= scope['icinga2::feature::influxdb::username'] -%>"
<% end -%>
<% if scope.lookupvar('icinga2::feature::influxdb::password') -%>
  password = "<%= scope['icinga2::feature::influxdb::password'] -%>"
<% end -%>
  ssl_enable = <%= scope['icinga2::feature::influxdb::ssl_enable'] %>
<% if scope.lookupvar('icinga2::feature::influxdb::ssl_ca_cert') -%>
  ssl_ca_cert = "<%= scope['icinga2::feature::influxdb::ssl_ca_cert'] -%>"
<% end -%>
<% if scope.lookupvar('icinga2::feature::influxdb::ssl_cert') -%>
  ssl_cert = "<%= scope['icinga2::feature::influxdb::ssl_cert'] -%>"
<% end -%>
<% if scope.lookupvar('icinga2::feature::influxdb::ssl_key') -%>
  ssl_key = "<%= scope['icinga2::feature::influxdb::ssl_key'] -%>"
<% end -%>
  enable_send_thresholds = <%= scope['icinga2::feature::influxdb::enable_send_thresholds'] %>
  enable_send_metadata = <%= scope['icinga2::feature::influxdb::enable_send_metadata'] %>
<% if scope.lookupvar('icinga2::feature::influxdb::flush_interval') -%>
  flush_interval = <%= scope['icinga2::feature::influxdb::flush_interval'] %>
<% end -%>
<% if scope.lookupvar('icinga2::feature::influxdb::flush_interval') -%>
  flush_threshold = <%= scope['icinga2::feature::influxdb::flush_threshold'] %>
<% end -%>

  host_template = {
<% scope['icinga2::feature::influxdb::host_template'].keys.sort.each do |k| -%>
<% if scope['icinga2::feature::influxdb::host_template'][k].is_a?(String) -%>
    <%= k %> = "<%= scope['icinga2::feature::influxdb::host_template'][k] %>"
<% elsif scope['icinga2::feature::influxdb::host_template'][k].is_a?(Hash) -%>
    <%= k %> = {
<% scope['icinga2::feature::influxdb::host_template'][k].keys.sort.each do |j| -%>
      <%= j %> = "<%= scope['icinga2::feature::influxdb::host_template'][k][j] %>"
<% end -%>
    }
  <% end -%>
<% end -%>
}

  service_template = {
<% scope['icinga2::feature::influxdb::service_template'].keys.sort.each do |k| -%>
<% if scope['icinga2::feature::influxdb::service_template'][k].is_a?(String) -%>
    <%= k %> = "<%= scope['icinga2::feature::influxdb::service_template'][k] %>"
<% elsif scope['icinga2::feature::influxdb::service_template'][k].is_a?(Hash) -%>
    <%= k %> = {
<% scope['icinga2::feature::influxdb::service_template'][k].keys.sort.each do |j| -%>
      <%= j %> = "<%= scope['icinga2::feature::influxdb::service_template'][k][j] %>"
<% end -%>
    }
  <% end -%>
<% end -%>
}

}
